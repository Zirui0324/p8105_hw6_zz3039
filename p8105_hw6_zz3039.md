p8105_hw6_zz3039
================
2022-11-30

## Problem 2

``` r
homi_data = 
  read_csv("./data/homicide-data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    city_state = paste(city, state, sep=", "),
    status = case_when(
      disposition %in% c("Closed by arrest", "Closed without arrest") ~ "solved",
      TRUE ~ "unsolved"),
    status = as.factor(status),
    victim_age = as.numeric(victim_age),
    victim_sex = fct_relevel(victim_sex, "Female")) %>% 
  filter(city_state != "Dallas, TX",
         city_state != "Kansas City, MO",
         city_state != "Phoenix, AZ",
         city_state != "Tulsa, AL",
         victim_race == "White"|victim_race == "Black") %>% 
  select(city_state, everything(), - city, - state) %>% 
  drop_na()
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

    ## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

obtain the estimate and confidence interval of the adjusted odds ratio
for solving homicides comparing male victims to female victims keeping
all other variables fixed.

``` r
bal_data = 
  homi_data %>% 
  filter(city_state == "Baltimore, MD")

fit_bal = 
  glm(status ~ victim_age + victim_sex + victim_race, data = bal_data, family = binomial) 

fit_bal %>% 
  broom::glance()
```

    ## # A tibble: 1 × 8
    ##   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
    ##           <dbl>   <int>  <dbl> <dbl> <dbl>    <dbl>       <int> <int>
    ## 1         3717.    2752 -1810. 3627. 3651.    3619.        2749  2753

``` r
fit_bal %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>%
  select(term, log_OR = estimate, OR, p.value) %>% 
  knitr::kable(digits = 3)
```

| term             | log_OR |    OR | p.value |
|:-----------------|-------:|------:|--------:|
| (Intercept)      | -0.664 | 0.515 |    0.00 |
| victim_age       |  0.005 | 1.005 |    0.11 |
| victim_sexMale   |  1.037 | 2.820 |    0.00 |
| victim_raceWhite | -0.900 | 0.407 |    0.00 |

``` r
bal_data %>% 
  modelr::add_predictions(fit_bal) %>% 
  mutate(fitted_prob = boot::inv.logit(pred))
```

    ## # A tibble: 2,753 × 14
    ##    city_state  uid   repor…¹ victi…² victi…³ victi…⁴ victi…⁵ victi…⁶   lat   lon
    ##    <chr>       <chr>   <dbl> <chr>   <chr>   <chr>     <dbl> <fct>   <dbl> <dbl>
    ##  1 Baltimore,… Bal-…  2.01e7 NELSON  LEON    Black        17 Male     39.3 -76.7
    ##  2 Baltimore,… Bal-…  2.01e7 GOLF    EDDIE   Black        26 Male     39.3 -76.7
    ##  3 Baltimore,… Bal-…  2.01e7 MACKEN… THOMAS… Black        21 Male     39.4 -76.6
    ##  4 Baltimore,… Bal-…  2.01e7 CANUPP  EDWARD… White        61 Male     39.2 -76.6
    ##  5 Baltimore,… Bal-…  2.01e7 CUNNIN… MICHAEL Black        46 Male     39.4 -76.6
    ##  6 Baltimore,… Bal-…  2.01e7 ALSTON  RAY WI… Black        27 Male     39.3 -76.6
    ##  7 Baltimore,… Bal-…  2.01e7 HENDER… YULE A… Black        21 Male     39.3 -76.6
    ##  8 Baltimore,… Bal-…  2.01e7 MCDOWE… MARCU   Black        16 Male     39.3 -76.6
    ##  9 Baltimore,… Bal-…  2.01e7 GARDNER RODNEY… Black        21 Male     39.3 -76.6
    ## 10 Baltimore,… Bal-…  2.01e7 BURNET… NELSENE Black        44 Female   39.3 -76.7
    ## # … with 2,743 more rows, 4 more variables: disposition <chr>, status <fct>,
    ## #   pred <dbl>, fitted_prob <dbl>, and abbreviated variable names
    ## #   ¹​reported_date, ²​victim_last, ³​victim_first, ⁴​victim_race, ⁵​victim_age,
    ## #   ⁶​victim_sex
