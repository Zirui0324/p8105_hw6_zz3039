---
title: "p8105_hw6_zz3039"
output: github_document
date: "2022-11-30"
---

```{r setup, include=FALSE}
library(tidyverse)
library(readr)

set.seed(1)
```

## Problem 2

```{r}
homi_data = 
  read_csv("./data/homicide-data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    city_state = paste(city, state, sep=", "),
    status = case_when(
      disposition %in% c("Closed by arrest", "Closed without arrest") ~ "solved",
      TRUE ~ "unsolved"),
    status = as.factor(status),
    victim_age = as.numeric(victim_age),
    victim_sex = fct_relevel(victim_sex, "Female")) %>% 
  filter(city_state != "Dallas, TX",
         city_state != "Kansas City, MO",
         city_state != "Phoenix, AZ",
         city_state != "Tulsa, AL",
         victim_race == "White"|victim_race == "Black") %>% 
  select(city_state, everything(), - city, - state) %>% 
  drop_na()
```

obtain the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing male victims to female victims keeping all other variables fixed.

```{r}
bal_data = 
  homi_data %>% 
  filter(city_state == "Baltimore, MD")

fit_bal = 
  glm(status ~ victim_age + victim_sex + victim_race, data = bal_data, family = binomial) 

fit_bal %>% 
  broom::glance()

fit_bal %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>%
  select(term, log_OR = estimate, OR, p.value) %>% 
  mutate(term = str_replace(term, "^victim_", "Victim "),
         term = str_replace(term, "sex", "sex: "),
         term = str_replace(term, "race", "race: " )) %>% 
  knitr::kable(digits = 3)

bal_data %>% 
  modelr::add_predictions(fit_bal) %>% 
  mutate(fitted_prob = boot::inv.logit(pred))
```


## Problem 3

```{r chunk_data import}
bw_data = 
  read_csv("./data/birthweight.csv") %>% 
  janitor::clean_names()

skimr::skim(bw_data)

bw_data = 
  bw_data %>% 
  mutate(
    babysex = as.factor(babysex),
    frace = as.factor(frace),
    malform = as.factor(malform),
    mrace = as.factor(mrace))

skimr::skim(bw_data)
```


Propose a regression model for birthweight. This model may be based on a hypothesized structure for the factors that underly birthweight, on a data-driven model-building process, or a combination of the two. Describe your modeling process and show a plot of model residuals against fitted values â€“ use add_predictions and add_residuals in making this plot.
```{r chunk_propose a model}
bw_lm = lm(bwt ~ wtgain + ppwt + ppbmi, data = bw_data)
summary(bw_lm)

bw_data %>% 
  modelr::add_residuals(bw_lm) %>% 
  ggplot(aes(x = bwt, y = resid)) + geom_violin()

bw_lm %>% 
  plot(which = 2)
```

